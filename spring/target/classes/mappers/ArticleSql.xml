<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="articleSql">

	<resultMap type="kr.mz.study.spring.article.model.Article" id="articleMap">
		<result property="userName" column="user_nm"/>
		<result property="password" column="article_pw"/>
	</resultMap>
	<parameterMap type="kr.mz.study.spring.article.model.Article" id="articleParamMap">
		<parameter property="userName"/>
		<parameter property="password"/>
		<parameter property="idx"/>
	</parameterMap>
	
	<select id="getListCount" resultType="int">
	  	SELECT 
	  		COUNT(idx) 
	  	  FROM 
	  	  	BOARD 
	  	 WHERE 
	  	 	deleted = 0
	</select>
  
	<select id="getArticleList" parameterType="map" resultMap="articleMap">
	  	SELECT 
	  		idx, 
	  		user_nm, 
	  		article_pw, 
	  		title, 
	  		content, 
	  		created 
	  	  FROM 
	  	  	BOARD 
	  	 WHERE 
	  	 	deleted = 0 
	  	 ORDER BY 
	  	 	idx 
	  	 DESC 
	  	 	LIMIT #{firstPost}, #{countPostPerPage}
	</select>

	<select id="getArticleDetail" resultMap="articleMap">
		SELECT 
			user_nm, 
			article_pw, 
			title, 
			content, 
			created 
		 FROM 
		  	BOARD 
		 WHERE 
		 	idx = #{idx}
	</select>  

	<insert id="createArticle" parameterMap="articleParamMap">
		INSERT INTO BOARD (
					user_nm, 
					article_pw, 
					title, 
					content, 
					created, 
					deleted
				) VALUES (
					#{userName}, 
					#{password}, 
					#{title}, 
					#{content}, 
					NOW(), 
					0
				)
	</insert>
	
	<update id="modifyArticle" parameterMap="articleParamMap">
		UPDATE 
			BOARD 
		   SET 
		   	user_nm = #{userName}, 
		   	article_pw = #{password}, 
		   	title = #{title}, 
		   	content = #{content} 
		 WHERE 
		 	idx = #{idx}
	</update>
	
	<update id="deleteArticle" parameterType="map">
		UPDATE 
			BOARD 
		   SET 
		   	deleted = 1
		 WHERE 
		 	idx = #{idx}
	</update>
	
	<select id="checkPassword" parameterType="map" resultType="String">
		SELECT 
			article_pw 
		  FROM 
		  	BOARD 
		 WHERE 
		 	idx = #{idx}
	</select>
	
</mapper>
		
	